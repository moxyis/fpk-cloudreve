name: ç‰ˆæœ¬æ¯”å¯¹åè‡ªåŠ¨æ‰“åŒ…Cloudreveå¹¶æ›´æ–°ä»“åº“

on:
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 0 * * *'  

# è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ï¼ˆè°ƒè¯•å¼€å…³ï¼štrue=å¼€å¯è¯¦ç»†è°ƒè¯•ï¼Œfalse=å…³é—­ï¼‰
env:
  DEBUG_MODE: "false"  

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # æˆäºˆå†™å…¥ä»“åº“/åˆ›å»ºReleaseæƒé™
      pull-requests: read
    steps:
      # ===================== ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡ =====================
      - name: 1. æ£€å‡ºå½“å‰ä»“åº“ä»£ç ï¼ˆå¸¦å®Œæ•´å†å²ï¼‰
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # å®Œæ•´æ£€å‡ºå†å²
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 2. é…ç½®Gitå…¨å±€èº«ä»½ï¼ˆè·¨ä»“åº“æ¨é€é€šç”¨ï¼‰
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      - name: 3. å®‰è£…åŸºç¡€ä¾èµ–ï¼ˆjq/curl/sedï¼‰
        run: |
          sudo apt update && sudo apt install -y jq curl sed
          echo "åŸºç¡€ä¾èµ–å®‰è£…å®Œæˆ"
          # è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºç³»ç»Ÿä¿¡æ¯
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šç³»ç»Ÿæ¶æ„ ====="
            uname -m
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šç¯å¢ƒå˜é‡ ====="
            env | grep -E "DEBUG|VERSION|ARCH"
          fi

      # ===================== ç¬¬äºŒæ­¥ï¼šç‰ˆæœ¬&æ¶æ„æ¯”å¯¹ï¼ˆæ ¸å¿ƒå‰ç½®ï¼‰ =====================
      - name: 4. è¯»å–æœ¬åœ°manifestç‰ˆæœ¬å·+å¹³å°æ¶æ„
        id: local_info
        run: |
          # åˆ›å»ºmanifestç›®å½•ï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰
          mkdir -p Cloudreve
          # åˆå§‹åŒ–manifestï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰
          if [ ! -f "Cloudreve/manifest" ]; then
            echo "version: 0.0.0" > Cloudreve/manifest
            echo "platform: x86" >> Cloudreve/manifest
            git add Cloudreve/manifest
            git commit -m "chore: åˆå§‹åŒ–manifestæ–‡ä»¶ï¼ˆå«platformå­—æ®µï¼‰" || echo "æ— éœ€è¦æäº¤çš„å˜æ›´"
          fi

          # è¯»å–ç‰ˆæœ¬å·
          LOCAL_VERSION=$(sed -n 's/^[[:space:]]*version[[:space:]]*[:=][[:space:]]*//p' Cloudreve/manifest \
            | tr -d '"' | tr -d "'" | sed 's/^v//' | xargs)
          # è¯»å–å¹³å°æ¶æ„ï¼ˆx86/armï¼‰
          LOCAL_PLATFORM=$(sed -n 's/^[[:space:]]*platform[[:space:]]*[:=][[:space:]]*//p' Cloudreve/manifest \
            | tr -d '"' | tr -d "'" | xargs | tr '[:upper:]' '[:lower:]')
          
          # æ ¡éªŒplatformåˆæ³•æ€§
          if [[ "$LOCAL_PLATFORM" != "x86" && "$LOCAL_PLATFORM" != "arm" ]]; then
            echo "âŒ manifestä¸­platformå­—æ®µå€¼éæ³•ï¼ˆ$LOCAL_PLATFORMï¼‰ï¼Œä»…æ”¯æŒx86/arm"
            exit 1
          fi

          # è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºæœ¬åœ°ä¿¡æ¯
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šæœ¬åœ°Manifest ====="
            cat Cloudreve/manifest
            echo "=================================="
          fi

          echo "æœ¬åœ°manifestç‰ˆæœ¬ï¼š$LOCAL_VERSION"
          echo "æœ¬åœ°manifestæ¶æ„ï¼š$LOCAL_PLATFORM"
          echo "local_version=$LOCAL_VERSION" >> $GITHUB_OUTPUT
          echo "local_platform=$LOCAL_PLATFORM" >> $GITHUB_OUTPUT

      - name: 5. è·å–Cloudreveå®˜æ–¹æœ€æ–°æ­£å¼ç‰ˆç‰ˆæœ¬å·+æ¶æ„æ˜ å°„
        id: remote_info
        run: |
          # è·å–è¿œç¨‹ç‰ˆæœ¬å·
          REMOTE_VERSION=$(curl -sSL --retry 3 --connect-timeout 10 \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/cloudreve/Cloudreve/releases/latest" \
            | jq -r '.tag_name' | sed 's/^v//' | xargs)
          
          if [ -z "$REMOTE_VERSION" ] || [ "$REMOTE_VERSION" = "null" ]; then
            echo "âŒ è·å–è¿œç¨‹ç‰ˆæœ¬å¤±è´¥"
            exit 1
          fi

          # æ¶æ„æ˜ å°„ï¼šmanifestçš„platform â†’ Cloudreveå®˜æ–¹æ¶æ„åŒ…åç§°
          case "${{ steps.local_info.outputs.local_platform }}" in
            "x86")
              REMOTE_ARCH="linux_amd64"
              ARCH_LABEL="Linux-AMD64"
              ;;
            "arm")
              REMOTE_ARCH="linux_arm64"
              ARCH_LABEL="Linux-ARM64"
              ;;
            *)
              echo "âŒ ä¸æ”¯æŒçš„æ¶æ„ç±»å‹ï¼ˆ${{ steps.local_info.outputs.local_platform }}ï¼‰"
              exit 1
              ;;
          esac

          # è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºè¿œç¨‹ä¿¡æ¯
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šè¿œç¨‹é…ç½® ====="
            echo "è¿œç¨‹ç‰ˆæœ¬ï¼š$REMOTE_VERSION"
            echo "è¿œç¨‹æ¶æ„åŒ…åç§°ï¼š$REMOTE_ARCH"
            echo "æ¶æ„æ ‡ç­¾ï¼š$ARCH_LABEL"
            echo "=============================="
          fi

          echo "remote_version=$REMOTE_VERSION" >> $GITHUB_OUTPUT
          echo "remote_arch=$REMOTE_ARCH" >> $GITHUB_OUTPUT
          echo "arch_label=$ARCH_LABEL" >> $GITHUB_OUTPUT

      - name: 6. ç‰ˆæœ¬æ¯”å¯¹ï¼Œåˆ¤æ–­æ˜¯å¦æ›´æ–°
        id: compare
        run: |
          if [ "${{ steps.local_info.outputs.local_version }}" = "${{ steps.remote_info.outputs.remote_version }}" ]; then
            echo "âœ… æœ¬åœ°ç‰ˆæœ¬ä¸è¿œç¨‹ç‰ˆæœ¬ä¸€è‡´ï¼ˆ${{ steps.remote_info.outputs.remote_version }}ï¼‰ï¼Œæ— éœ€æ›´æ–°"
            echo "need_update=false" >> $GITHUB_OUTPUT
          else
            echo "ğŸ”„ ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå¼€å§‹æ›´æ–°æ‰“åŒ…æµç¨‹"
            echo "need_update=true" >> $GITHUB_OUTPUT
          fi

      # ===================== ç¬¬ä¸‰æ­¥ï¼šä»…ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶æ‰§è¡Œ =====================
      - name: 7. ä¸‹è½½å¯¹åº”æ¶æ„çš„CloudreveäºŒè¿›åˆ¶åŒ…
        if: steps.compare.outputs.need_update == 'true'
        id: download_cloudreve
        run: |
          set -euo pipefail
          
          # 1. è·å–å®Œæ•´å‘è¡Œç‰ˆæ•°æ®
          RELEASE_DATA=$(curl -sSL --retry 3 --connect-timeout 10 \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/cloudreve/Cloudreve/releases/latest")
          
          # 2. è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºæ‰€æœ‰èµ„äº§åç§°
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šè¿œç¨‹å‘è¡Œç‰ˆæ‰€æœ‰èµ„äº§ ====="
            echo "$RELEASE_DATA" | jq -r '.assets[].name'
            echo "======================================"
          fi
          
          # 3. åŒ¹é…å¯¹åº”æ¶æ„çš„åŒ…ï¼ˆx86â†’linux_amd64ï¼Œarmâ†’linux_arm64ï¼‰
          DOWNLOAD_URL=$(echo "$RELEASE_DATA" | jq -r \
            --arg arch "${{ steps.remote_info.outputs.remote_arch }}" \
            '.assets[] | select(.name | contains($arch + ".tar.gz")) | .browser_download_url' | head -n1)
          
          # 4. æ ¡éªŒä¸‹è½½é“¾æ¥
          if [ -z "$DOWNLOAD_URL" ] || [ "$DOWNLOAD_URL" = "null" ]; then
            echo "âŒ æœªæ‰¾åˆ°${{ steps.remote_info.outputs.remote_arch }}æ¶æ„çš„èµ„äº§åŒ…"
            exit 1
          fi
          
          # 5. æå–åŒ¹é…åˆ°çš„èµ„äº§å
          MATCHED_ASSET=$(echo "$RELEASE_DATA" | jq -r \
            --arg arch "${{ steps.remote_info.outputs.remote_arch }}" \
            '.assets[] | select(.name | contains($arch + ".tar.gz")) | .name' | head -n1)
          
          # è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºä¸‹è½½ä¿¡æ¯
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šä¸‹è½½é…ç½® ====="
            echo "åŒ¹é…åˆ°èµ„äº§ï¼š$MATCHED_ASSET"
            echo "ä¸‹è½½é“¾æ¥ï¼š$DOWNLOAD_URL"
            echo "=============================="
          fi
          
          # 6. åˆ›å»ºç›®å½•å¹¶ä¸‹è½½
          mkdir -p Cloudreve/app/bin
          curl -SL --retry 3 --connect-timeout 10 -o /tmp/cloudreve.tar.gz "$DOWNLOAD_URL"
          
          # 7. è§£å‹å¹¶éªŒè¯äºŒè¿›åˆ¶æ–‡ä»¶
          tar -zxf /tmp/cloudreve.tar.gz -C /tmp
          if [ ! -f "/tmp/cloudreve" ]; then
            echo "âŒ è§£å‹åæœªæ‰¾åˆ°cloudreveäºŒè¿›åˆ¶æ–‡ä»¶"
            exit 1
          fi
          
          # 8. ç§»åŠ¨æ–‡ä»¶+æ·»åŠ æ‰§è¡Œæƒé™
          mv /tmp/cloudreve Cloudreve/app/bin/
          chmod +x Cloudreve/app/bin/cloudreve
          rm -rf /tmp/cloudreve.tar.gz /tmp/cloudreve
          
          # 9. éªŒè¯æ–‡ä»¶ä¿¡æ¯
          echo "âœ… ä¸‹è½½å®Œæˆï¼Œæ–‡ä»¶ä¿¡æ¯ï¼š"
          ls -lh Cloudreve/app/bin/cloudreve
          file Cloudreve/app/bin/cloudreve

      - name: 8. æ›´æ–°manifestçš„version+platformå­—æ®µï¼ˆé˜²ç¯¡æ”¹ï¼‰
        if: steps.compare.outputs.need_update == 'true'
        run: |
          # æ›´æ–°ç‰ˆæœ¬å·
          sed -i -E \
            "s/(^[[:space:]]*version[[:space:]]*[:=][[:space:]]*)([\"']?)([0-9a-zA-Z.]+)([\"']?)/\1\2${{ steps.remote_info.outputs.remote_version }}\4/" \
            Cloudreve/manifest
          
          # ç¡®ä¿platformå­—æ®µå€¼æ­£ç¡®ï¼ˆé˜²æ‰‹åŠ¨ä¿®æ”¹é”™è¯¯ï¼‰
          sed -i -E \
            "s/(^[[:space:]]*platform[[:space:]]*[:=][[:space:]]*)([\"']?)([a-zA-Z0-9]+)([\"']?)/\1\2${{ steps.local_info.outputs.local_platform }}\4/" \
            Cloudreve/manifest
          
          echo "âœ… manifestæ›´æ–°å®Œæˆï¼š"
          echo "  - ç‰ˆæœ¬ï¼š${{ steps.remote_info.outputs.remote_version }}"
          echo "  - æ¶æ„ï¼š${{ steps.local_info.outputs.local_platform }}"
          cat Cloudreve/manifest | grep -E "version|platform"

          # æš‚å­˜å˜æ›´
          git add Cloudreve/manifest

      - name: 9. æäº¤å¹¶æ¨é€manifestå˜æ›´åˆ°å½“å‰ä»“åº“
        if: steps.compare.outputs.need_update == 'true'
        run: |
          git commit -m "chore: æ›´æ–°Cloudreveç‰ˆæœ¬è‡³${{ steps.remote_info.outputs.remote_version }}ï¼ˆæ¶æ„ï¼š${{ steps.local_info.outputs.local_platform }}ï¼‰" || echo "âœ… æ— éœ€è¦æäº¤çš„manifestå˜æ›´"
          git push origin HEAD:${{ github.ref_name }}
          echo "âœ… manifestå·²æ¨é€åˆ°å½“å‰ä»“åº“"

      - name: 10. ä¸‹è½½å¹¶å®‰è£…fnpackï¼ˆæŒ‡å®šåœ°å€ï¼‰
        if: steps.compare.outputs.need_update == 'true'
        run: |
          FNPACK_URL="https://static2.fnnas.com/fnpack/fnpack-1.2.0-linux-amd64"
          curl -SL --retry 3 --connect-timeout 10 -o /usr/local/bin/fnpack "$FNPACK_URL"
          chmod +x /usr/local/bin/fnpack
          
          if ! command -v fnpack &>/dev/null; then
            echo "âŒ fnpackå®‰è£…å¤±è´¥"
            exit 1
          fi
          # è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºfnpackç‰ˆæœ¬
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šfnpack ====="
            fnpack --version || echo "fnpackæ— --versionå‚æ•°"
            echo "============================"
          fi
          echo "âœ… fnpackå®‰è£…å®Œæˆï¼š$(which fnpack)"

      - name: 11. è¿›å…¥Cloudreveç›®å½•æ‰§è¡Œfnpackæ‰“åŒ…
        if: steps.compare.outputs.need_update == 'true'
        id: build_fpk
        run: |
          # è¿›å…¥Cloudreveç›®å½•
          cd Cloudreve
          echo "ğŸš€ å¼€å§‹æ‰“åŒ…ï¼ˆæ¶æ„ï¼š${{ steps.local_info.outputs.local_platform }}ï¼‰"
          
          # è°ƒè¯•æ¨¡å¼ï¼šè¾“å‡ºæ‰“åŒ…å‰ç›®å½•ç»“æ„
          if [ "$DEBUG_MODE" = "true" ]; then
            echo "===== è°ƒè¯•ä¿¡æ¯ï¼šæ‰“åŒ…å‰ç›®å½• ====="
            ls -lhR .
            echo "=============================="
          fi
          
          fnpack build
          
          # æŸ¥æ‰¾æ‰“åŒ…åçš„fpkæ–‡ä»¶
          FPK_FILE=$(find . -name "*.fpk" -type f | head -n1)
          if [ -z "$FPK_FILE" ]; then
            echo "âŒ æœªæ‰¾åˆ°æ‰“åŒ…åçš„fpkæ–‡ä»¶"
            exit 1
          fi
          
          # æ‹¼æ¥å®Œæ•´è·¯å¾„
          FPK_FULL_PATH=$(pwd)/$FPK_FILE
          # å›ºå®šåç§°ï¼ˆæŒ‰æ¶æ„åŒºåˆ†ï¼‰
          FPK_FIXED_NAME="fpk-cloudreve-${{ steps.local_info.outputs.local_platform }}.fpk"
          # å¸¦ç‰ˆæœ¬+æ¶æ„çš„åç§°ï¼ˆç”¨äºReleaseï¼‰
          FPK_VERSION_NAME="fpk-cloudreve-v${{ steps.remote_info.outputs.remote_version }}-${{ steps.remote_info.outputs.arch_label }}.fpk"
          
          # å¤åˆ¶æ–‡ä»¶
          mv "$FPK_FULL_PATH" /tmp/$FPK_FIXED_NAME
          cp /tmp/$FPK_FIXED_NAME /tmp/$FPK_VERSION_NAME
          
          echo "âœ… æ‰“åŒ…å®Œæˆï¼š"
          echo "  - æ¶æ„ä¸“å±åç§°ï¼š/tmp/$FPK_FIXED_NAME"
          echo "  - ç‰ˆæœ¬+æ¶æ„åç§°ï¼š/tmp/$FPK_VERSION_NAME"
          echo "fpk_file=/tmp/$FPK_FIXED_NAME" >> $GITHUB_OUTPUT
          echo "fpk_name=$FPK_FIXED_NAME" >> $GITHUB_OUTPUT
          echo "fpk_release_file=/tmp/$FPK_VERSION_NAME" >> $GITHUB_OUTPUT
          echo "fpk_release_name=$FPK_VERSION_NAME" >> $GITHUB_OUTPUT

      # ===================== ç¬¬å››æ­¥ï¼šæ¨é€fpkåˆ°FnDepotä»“åº“ + æ›´æ–°é…ç½® =====================
      - name: 12. å…‹éš†FnDepotä»“åº“ï¼ˆç›®æ ‡ä»“åº“ï¼‰
        if: steps.compare.outputs.need_update == 'true'
        run: |
          git clone https://${{ secrets.FnDepot_PAT }}@github.com/moxyis/FnDepot.git /tmp/FnDepot
          echo "âœ… æˆåŠŸå…‹éš†FnDepotä»“åº“"

      - name: 13. å¤åˆ¶fpkæ–‡ä»¶åˆ°FnDepotä»“åº“ï¼ˆæŒ‰æ¶æ„åˆ†ç›®å½•ï¼‰
        if: steps.compare.outputs.need_update == 'true'
        run: |
          # åˆ›å»ºæ¶æ„ä¸“å±ç›®å½•ï¼ˆé¿å…ä¸åŒæ¶æ„æ–‡ä»¶å†²çªï¼‰
          TARGET_DIR="/tmp/FnDepot/fpk-cloudreve/${{ steps.local_info.outputs.local_platform }}"
          mkdir -p $TARGET_DIR
          
          # åˆ é™¤æ—§æ–‡ä»¶
          rm -f $TARGET_DIR/*.fpk
          
          # å¤åˆ¶æ–°æ–‡ä»¶
          cp ${{ steps.build_fpk.outputs.fpk_file }} $TARGET_DIR/
          
          echo "âœ… fpkæ–‡ä»¶å·²å¤åˆ¶åˆ°ï¼š$TARGET_DIR/${{ steps.build_fpk.outputs.fpk_name }}"
          ls -lh $TARGET_DIR/

      - name: 14. æ›´æ–°FnDepotä»“åº“çš„fnpack.jsonï¼ˆæŒ‰æ¶æ„åŒºåˆ†ç‰ˆæœ¬ï¼‰
        if: steps.compare.outputs.need_update == 'true'
        run: |
          cd /tmp/FnDepot
          
          # åˆå§‹åŒ–fnpack.jsonï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰
          if [ ! -f "fnpack.json" ]; then
            echo '{"fpk-cloudreve": {"x86": {"version": ""}, "arm": {"version": ""}}}' > fnpack.json
          fi
          
          # æ›´æ–°å¯¹åº”æ¶æ„çš„ç‰ˆæœ¬å·
          jq --arg plat "${{ steps.local_info.outputs.local_platform }}" \
             --arg ver "${{ steps.remote_info.outputs.remote_version }}" \
             '.["fpk-cloudreve"][$plat].version = $ver' fnpack.json > fnpack.tmp && mv fnpack.tmp fnpack.json
          
          echo "âœ… fnpack.jsonæ›´æ–°å®Œæˆï¼š"
          cat fnpack.json

      - name: 15. æ›´æ–°FnDepotä»“åº“README.mdï¼ˆæŒ‰æ¶æ„å±•ç¤ºç‰ˆæœ¬ï¼‰
        if: steps.compare.outputs.need_update == 'true'
        run: |
          cd /tmp/FnDepot
          
          # åˆå§‹åŒ–README.mdï¼ˆè‹¥ä¸å­˜åœ¨ï¼‰
          if [ ! -f "README.md" ]; then
            echo "# FnDepot\n\n| **åº”ç”¨** | **x86ç‰ˆæœ¬** | **ARMç‰ˆæœ¬** | **é“¾æ¥** |\n|----------|-------------|-------------|----------|\n| Cloudreve | ${{ steps.remote_info.outputs.remote_version }} | - | https://cloudreve.org/ |\n\nè‡ªåŠ¨åŒ–ä»“åº“ï¼šhttps://github.com/moxyis/fpk-cloudreve" > README.md
          else
            # æ›´æ–°å¯¹åº”æ¶æ„çš„ç‰ˆæœ¬å·
            if [ "${{ steps.local_info.outputs.local_platform }}" = "x86" ]; then
              sed -i -E \
                "s/(\|\s*Cloudreve\s*\|\s*)[0-9.]+\s*(\|\s*)([0-9.-]+|\-)(\s*\|\s*https:\/\/cloudreve.org\/\s*\|)/\1${{ steps.remote_info.outputs.remote_version }}\2\3\4/g" \
                README.md
            else
              sed -i -E \
                "s/(\|\s*Cloudreve\s*\|\s*)([0-9.-]+|\-)(\s*\|\s*)[0-9.]+\s*(\|\s*https:\/\/cloudreve.org\/\s*\|)/\1\2\3${{ steps.remote_info.outputs.remote_version }}\4/g" \
                README.md
            fi
          fi
          
          echo "âœ… README.mdæ›´æ–°å®Œæˆï¼Œå…³é”®å†…å®¹ï¼š"
          grep -A 2 -B 1 "Cloudreve" README.md

      - name: 16. æäº¤å¹¶æ¨é€æ‰€æœ‰å˜æ›´åˆ°FnDepotä»“åº“
        if: steps.compare.outputs.need_update == 'true'
        run: |
          cd /tmp/FnDepot
          
          # æš‚å­˜å˜æ›´
          git add fpk-cloudreve/ fnpack.json README.md
          
          # æäº¤
          git commit -m "chore: æ›´æ–°Cloudreve ${{ steps.local_info.outputs.local_platform }} ç‰ˆæœ¬è‡³${{ steps.remote_info.outputs.remote_version }}" || echo "âœ… æ— éœ€è¦æäº¤çš„å˜æ›´"
          
          # æ¨é€
          git push origin main
          echo "âœ… å˜æ›´å·²æ¨é€åˆ°FnDepotä»“åº“"

      # ===================== ç¬¬äº”æ­¥ï¼šä¸Šä¼ åˆ°GitHub Releases =====================
      - name: 17. åˆ›å»ºGitHub Releaseå¹¶ä¸Šä¼ FPKæ–‡ä»¶
        if: steps.compare.outputs.need_update == 'true'
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "cloudreve-v${{ steps.remote_info.outputs.remote_version }}-${{ steps.remote_info.outputs.arch_label }}"
          name: "Cloudreve v${{ steps.remote_info.outputs.remote_version }} (${{ steps.remote_info.outputs.arch_label }})"
          body: |
            ## Cloudreve è‡ªåŠ¨æ‰“åŒ…æ›´æ–°
            - ç‰ˆæœ¬ï¼šv${{ steps.remote_info.outputs.remote_version }}
            - å¹³å°æ¶æ„ï¼š${{ steps.remote_info.outputs.arch_label }}ï¼ˆmanifest: ${{ steps.local_info.outputs.local_platform }}ï¼‰
            - æ‰“åŒ…æ ¼å¼ï¼šfpk
            - æ›´æ–°æ—¶é—´ï¼š${{ github.run_at }}
            - æ‰“åŒ…å·¥å…·ï¼šfnpack 1.2.0
            - FnDepotä»“åº“ï¼šhttps://github.com/moxyis/FnDepot/tree/main/fpk-cloudreve/${{ steps.local_info.outputs.local_platform }}
          prerelease: false
          files: ${{ steps.build_fpk.outputs.fpk_release_file }}
          overwrite: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
